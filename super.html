<!DOCTYPE html>
<html>
    <head>
        <title>aciPlugin _super demo - A helper for jQuery plugin creation</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery.aciPlugin.js"></script>
    </head>
    <body>

        <p><b>_super</b> parent call test: each call will write a string down in a DIV then call the parent method.<br />
            Calling the 'direct' method will process things without a delay. The 'timed' and 'error' methods both delay execution when calling the parent method with <b>_super</b>.<br />
        The delay is done with a setTimeout, the current method will exit before setTimeout calls the anonymous function.<br />
        The call to the 'error' method will produce an error in your browser.<br />
        The way to handle this is with the 'timed' method, where '_super' is saved to a local variable too.
        </p>

        <p>Note: see the source code to understand what's going on with the 'superDemo' implementation.</p>

        <div id="div1"></div>
        <div id="div2"></div>
        <div id="div3"></div>

        <script type="text/javascript">

            aciPluginClass.plugins.superDemo = aciPluginClass.aciPluginUi.extend({
                write_A: function(method){
                    this._instance.jQuery.append('from A [' + method + ']<br />');
                },
                direct: function(){
                    this.write_A('direct');
                },
                timed: function(){
                    this.write_A('timed');
                },
                error: function(){
                    this.write_A('error');
                }
            }, 'private_a');

            aciPluginClass.plugins.superDemo = aciPluginClass.plugins.superDemo.extend({
                write_B: function(method){
                    this._instance.jQuery.append('from B [' + method + ']<br />');
                },
                // direct call the parent is ok
                direct: function(){
                    this.write_B('direct');
                    this._super();
                },
                // the way to go with the delayed execution
                // (stuff that can be run after current method exits, like with a setTimeout)
                timed: function(){
                    this.write_B('timed');
                    // save into _this to reference from the anonymous function
                    var _this = this;
                    // save into _super to reference from the anonymous function
                    var _super = this._super;
                    setTimeout(function(){
                        // even if _this._super is restored to the old value just after 'timed' method exits
                        // we still have the reference to the old one ;)
                        _super.apply(_this);
                    }, 500);
                },
                // this will fail with an error in your browser
                // just because this._super will be restored to the previous value (undefined) just after the current method exits
                // (and the setTimeout anonymous function will be run after that - delayed 500 ms)
                error: function(){
                    this.write_B('error');
                    // save into _this to reference from the anonymous function
                    var _this = this;
                    setTimeout(function(){
                        // _super will be restored to previous value just after 'error' method exits so we'll get a error
                        _this._super();
                    }, 500);
                }
            }, 'private_b');

            aciPluginClass.publish('superDemo');

            $('#div1').append('direct:<br/>').superDemo('api').direct();

            $('#div2').append('timed:<br/>').superDemo('api').timed();

            $('#div3').append('error:<br/>').superDemo('api').error();

        </script>

    </body>
</html>
